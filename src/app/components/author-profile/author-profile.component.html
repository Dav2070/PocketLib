<!-- Normal layout -->
<div
	class="container ms-motion-slideUpIn"
	[style.paddingBottom.px]="dataService.bottomToolbarVisible && !storeContext ? 56 : 0"
	*ngIf="!dualScreenLayout">

	<div class="row">
		<div class="col-10 offset-1 col-md-4 offset-md-0 col-xl-3 text-center pt-5">
			<pocketlib-blurhash-image
				[src]="profileImageContent"
				[fallback]="dataService.defaultProfileImageUrl"
				[blurhash]="author.profileImageBlurhash"
				[title]="author.firstName + ' ' + author.lastName"
				[alt]="profileImageAlt"
				[width]="profileImageWidth"
				[height]="profileImageWidth"
				margin="0 0 1rem 0"
				shadow="true"
				rounded="true"
				[loading]="profileImageLoading">
			</pocketlib-blurhash-image>
			<br>

			<dav-button
				type="accent"
				ngxFilePicker
				accept="image/png,image/jpeg"
				[disabled]="profileImageLoading"
				(filePick)="UploadProfileImage($event)"
				*ngIf="authorMode != 0">
				{{ locale.uploadProfileImage }}
			</dav-button>

			<h4 class="d-flex justify-content-center mt-3 text-color">
				{{ author.firstName }} {{ author.lastName }}

				<button
					type="button"
					class="d-flex align-items-center btn ml-2 text-color theme-background-color-primary theme-border-color-primary icon-button"
					style="height: 32px; font-size: 17px; margin-top: -4px; padding: 0px 4px"
					(click)="ShowEditProfileDialog()"
					*ngIf="authorMode > 0">
					<i class="ms-Icon ms-Icon--Edit" style="font-size: 17px" aria-hidden="true"></i>
				</button>
			</h4>

			<div
				class="d-flex justify-content-center"
				*ngIf="author.websiteUrl || author.facebookUsername || author.instagramUsername || author.twitterUsername">

				<!-- Website -->
				<pocketlib-link-icon-button
					[icon]="faGlobe"
					[link]="author.websiteUrl"
					*ngIf="author.websiteUrl">
				</pocketlib-link-icon-button>

				<!-- Facebook -->
				<pocketlib-link-icon-button
					[icon]="faFacebook"
					[link]="facebookLink"
					*ngIf="author.facebookUsername">
				</pocketlib-link-icon-button>

				<!-- Instagram -->
				<pocketlib-link-icon-button
					[icon]="faInstagram"
					[link]="instagramLink"
					*ngIf="author.instagramUsername">
				</pocketlib-link-icon-button>

				<!-- Twitter -->
				<pocketlib-link-icon-button
					[icon]="faTwitter"
					[link]="twitterLink"
					*ngIf="author.twitterUsername">
				</pocketlib-link-icon-button>
			</div>

			<dav-dropdown
				class="mx-auto my-3"
				width="170"
				[options]="bioLanguageDropdownOptions"
				[selectedKey]="bioLanguageDropdownSelectedKey"
				(change)="BioLanguageDropdownChange($event)"
				*ngIf="authorMode != 0">
			</dav-dropdown>

			<!-- Display the content of the bio in the selected language -->
			<p class="mt-3 text-left text-color"
				style="white-space: pre-wrap"
				*ngIf="bioMode == 2">
				{{ currentBio }}
			</p>

			<!-- Text for the case that there are no bios -->
			<p class="mt-3 font-weight-light font-italic text-color" *ngIf="bioMode == 0">
				{{ locale.noBio }}
			</p>

			<div class="mx-auto my-3" style="width: 80%" *ngIf="bioMode == 1 || bioMode == 3">
				<fluent-text-area
					style="margin-top: 10px; width: 100%"
					resize="vertical"
					[value]="newBio"
					[placeholder]="locale.bioTextfieldPlaceholder"
					(input)="newBio = $event.target.value; newBioError = ''">
				</fluent-text-area>

				<p class="text-field-error text-left" *ngIf="newBioError.length > 0">
					{{ newBioError }}
				</p>
			</div>

			<dav-button
				type="accent"
				[disabled]="bioLoading"
				(click)="EditBio()"
				*ngIf="authorMode != 0 && bioMode != 0">
				{{ bioMode == 1 || bioMode == 3 ? locale.save : locale.edit }}
			</dav-button>

			<dav-button
				style="margin-left: 10px"
				[disabled]="bioLoading"
				(click)="CancelEditBio()"
				*ngIf="authorMode != 0 && bioMode == 3">
				{{ locale.cancel }}
			</dav-button>
		</div>
	
		<div class="col-12 col-md-6 pt-3 mx-auto" *ngIf="authorMode != 0">
			<!-- Message to sign up as a provider -->
			<div
				class="mt-3 mx-auto"
				style="min-width: 200px; max-width: 300px"
				*ngIf="showProviderMessage">

				<dav-message-bar type="warning">
					<span [innerHtml]="providerMessage"></span>
				</dav-message-bar>
			</div>

			<!-- List of collections -->
			<h3
				class="text-center font-weight-light mb-3 mb-md-4 text-color"
				[ngClass]="showProviderMessage ? 'mt-md-4' : 'mt-md-5'">
				{{ locale.yourBooks }}
			</h3>

			<div class="mt-3" *ngIf="!collectionsLoaded">
				<fluent-progress-ring
					class="mx-auto"
					style="width: 28px; height: 28px">
				</fluent-progress-ring>
			</div>

			<div *ngIf="collectionsLoaded">
				<pocketlib-add-list-item
					[link]="newBookPageLink.path"
					[linkParams]="newBookPageLink.params">
				</pocketlib-add-list-item>

				<pocketlib-horizontal-book-card
					[title]="collection.name"
					[coverContent]="collection.books.length > 0 && collection.books[0].coverContent ? collection.books[0].coverContent : dataService.defaultStoreBookCover"
					[coverBlurhash]="collection.books.length > 0 && collection.books[0].coverContent ? collection.books[0].coverBlurhash : null"
					[link]="collection.books.length == 1 ? ('/author/book/' + collection.books[0].uuid) : ('/author/collection/' + collection.uuid)"
					*ngFor="let collection of collections">
				</pocketlib-horizontal-book-card>
			</div>
		</div>

		<div class="col-12 col-md-6 pt-3 mx-auto" *ngIf="authorMode == 0">
			<!-- List of books -->
			<pocketlib-horizontal-book-card
				[title]="book.title"
				[coverContent]="book.coverContent"
				[coverBlurhash]="book.coverBlurhash"
				[link]="'/store/book/' + book.uuid"
				*ngFor="let book of books">
			</pocketlib-horizontal-book-card>
		</div>
	</div>
</div>

<!-- Dual-Screen layout -->
<div
	class="ms-motion-slideUpIn"
	style="display: grid; grid-template-rows: auto"
	[style.gridTemplateColumns]="'auto ' + (width / 2) + 'px'"
	*ngIf="dualScreenLayout">

	<!-- Left screen -->
	<div
		class="d-flex justify-content-center"
		style="grid-row: 1; grid-column: 1;"
		[style.marginRight.px]="dualScreenFoldMargin">

		<div class="text-center">
			<div class="mx-auto pt-5">
				<pocketlib-blurhash-image
					[src]="profileImageContent"
					[fallback]="dataService.defaultProfileImageUrl"
					[blurhash]="author.profileImageBlurhash"
					[title]="author.firstName + ' ' + author.lastName"
					[alt]="profileImageAlt"
					[width]="profileImageWidth"
					[height]="profileImageWidth"
					margin="0 0 1rem 0"
					shadow="true"
					rounded="true"
					[loading]="profileImageLoading">
				</pocketlib-blurhash-image>
				<br>
	
				<dav-button
					type="accent"
					ngxFilePicker
					accept="image/png,image/jpeg"
					[disabled]="profileImageLoading"
					(filePick)="UploadProfileImage($event)"
					*ngIf="authorMode != 0">
					{{ locale.uploadProfileImage }}
				</dav-button>
			</div>
	
			<h4 class="d-flex justify-content-center mt-3 text-color">
				{{ author.firstName }} {{ author.lastName }}
				
				<button
					type="button"
					class="d-flex align-items-center btn ml-2 text-color theme-background-color-primary theme-border-color-primary icon-button"
					style="height: 32px; font-size: 17px; margin-top: -4px; padding: 0px 4px"
					(click)="ShowEditProfileDialog()"
					*ngIf="authorMode > 0">
					<i class="ms-Icon ms-Icon--Edit" style="font-size: 17px" aria-hidden="true"></i>
				</button>
			</h4>
	
			<div
				class="d-flex justify-content-center"
				*ngIf="author.websiteUrl || author.facebookUsername || author.instagramUsername || author.twitterUsername">
				
				<!-- Website -->
				<pocketlib-link-icon-button
					[icon]="faGlobe"
					[link]="author.websiteUrl"
					*ngIf="author.websiteUrl">
				</pocketlib-link-icon-button>
	
				<!-- Facebook -->
				<pocketlib-link-icon-button
					[icon]="faFacebook"
					[link]="facebookLink"
					*ngIf="author.facebookUsername">
				</pocketlib-link-icon-button>
	
				<!-- Instagram -->
				<pocketlib-link-icon-button
					[icon]="faInstagram"
					[link]="instagramLink"
					*ngIf="author.instagramUsername">
				</pocketlib-link-icon-button>
	
				<!-- Twitter -->
				<pocketlib-link-icon-button
					[icon]="faTwitter"
					[link]="twitterLink"
					*ngIf="author.twitterUsername">
				</pocketlib-link-icon-button>
			</div>

			<dav-dropdown
				class="mx-auto my-3"
				width="170"
				[options]="bioLanguageDropdownOptions"
				[selectedKey]="bioLanguageDropdownSelectedKey"
				(change)="BioLanguageDropdownChange($event)"
				*ngIf="authorMode != 0">
			</dav-dropdown>

			<!-- Display the content of the bio in the selected language -->
			<p class="mt-3 text-left text-color"
				style="white-space: pre-wrap; max-width: 250px"
				*ngIf="bioMode == 2">
				{{ currentBio }}
			</p>

			<!-- Text for the case that there are no bios -->
			<p class="mt-3 font-weight-light font-italic text-color" *ngIf="bioMode == 0">
				{{ locale.noBio }}
			</p>

			<div class="mx-auto my-3" style="width: 80%" *ngIf="bioMode == 1 || bioMode == 3">
				<fluent-text-area
					style="margin-top: 10px; width: 100%"
					resize="vertical"
					[value]="newBio"
					[placeholder]="locale.bioTextfieldPlaceholder"
					(input)="newBio = $event.target.value; newBioError = ''">
				</fluent-text-area>

				<p class="text-field-error text-left" *ngIf="newBioError.length > 0">
					{{ newBioError }}
				</p>
			</div>

			<dav-button
				type="accent"
				[disabled]="bioLoading"
				(click)="EditBio()"
				*ngIf="authorMode != 0 && bioMode != 0">
				{{ bioMode == 1 || bioMode == 3 ? locale.save : locale.edit }}
			</dav-button>

			<dav-button
				style="margin-left: 10px"
				[disabled]="bioLoading"
				(click)="CancelEditBio()"
				*ngIf="authorMode != 0 && bioMode == 3">
				{{ locale.cancel }}
			</dav-button>
		</div>
	</div>

	<!-- Right screen -->
	<div
		style="grid-row: 1; grid-column: 2;"
		[style.marginLeft.px]="dualScreenFoldMargin">

		<div
			class="px-5"
			style="overflow: scroll"
			[style.height.px]="dataService.contentHeight">

			<div *ngIf="authorMode != 0">
				<!-- Message to sign up as a provider -->
				<div
					class="mt-3 mx-auto"
					style="min-width: 200px; max-width: 300px"
					*ngIf="showProviderMessage">

					<dav-message-bar type="warning">
						<span [innerHtml]="providerMessage"></span>
					</dav-message-bar>
				</div>

				<!-- List of collections -->
				<h3
					class="text-center font-weight-light mb-3 mb-md-4 text-color"
					[ngClass]="showProviderMessage ? 'mt-md-4' : 'mt-md-5'">
					{{ locale.yourBooks }}
				</h3>

				<div class="mt-3" *ngIf="!collectionsLoaded">
					<fluent-progress-ring
						class="mx-auto"
						style="width: 28px; height: 28px">
					</fluent-progress-ring>
				</div>

				<div *ngIf="collectionsLoaded">
					<pocketlib-add-list-item
						[link]="newBookPageLink.path"
						[linkParams]="newBookPageLink.params">
					</pocketlib-add-list-item>

					<pocketlib-horizontal-book-card
						[title]="collection.name"
						[coverContent]="collection.books.length > 0 && collection.books[0].coverContent ? collection.books[0].coverContent : dataService.defaultStoreBookCover"
						[coverBlurhash]="collection.books.length > 0 && collection.books[0].coverContent ? collection.books[0].coverBlurhash : null"
						[link]="collection.books.length == 1 ? ('/author/book/' + collection.books[0].uuid) : ('/author/collection/' + collection.uuid)"
						*ngFor="let collection of collections">
					</pocketlib-horizontal-book-card>
				</div>
			</div>

			<div *ngIf="authorMode == 0">
				<!-- List of books -->
				<pocketlib-horizontal-book-card
					[title]="book.title"
					[coverContent]="book.coverContent"
					[coverBlurhash]="book.coverBlurhash"
					[link]="'/store/book/' + book.uuid"
					*ngFor="let book of books">
				</pocketlib-horizontal-book-card>
			</div>
		</div>
	</div>
</div>

<dav-dialog
	[title]="locale.editProfileDialog.title"
	[primaryButtonText]="locale.save"
	[defaultButtonText]="locale.cancel"
	(dismiss)="editProfileDialogVisible = false"
	(primaryButtonClick)="SaveProfile()"
	(defaultButtonClick)="editProfileDialogVisible = false"
	*ngIf="editProfileDialogVisible">

	<!-- First name -->
	<div class="mb-3">
		<fluent-text-field
			style="width: 100%"
			[value]="editProfileDialogFirstName"
			placeholder="Monty"
			(input)="editProfileDialogFirstName = $event.target.value; editProfileDialogFirstNameError = ''"
			(keydown.enter)="SaveProfile()">
			{{ locale.editProfileDialog.firstNameTextfieldLabel }}
		</fluent-text-field>

		<p class="text-field-error" *ngIf="editProfileDialogFirstNameError.length > 0">
			{{ editProfileDialogFirstNameError }}
		</p>
	</div>

	<!-- Last name -->
	<div class="mb-3">
		<fluent-text-field
			style="width: 100%"
			[value]="editProfileDialogLastName"
			placeholder="Kensicle"
			(input)="editProfileDialogLastName = $event.target.value; editProfileDialogLastNameError = ''"
			(keydown.enter)="SaveProfile()">
			{{ locale.editProfileDialog.lastNameTextfieldLabel }}
		</fluent-text-field>

		<p class="text-field-error" *ngIf="editProfileDialogLastNameError.length > 0">
			{{ editProfileDialogLastNameError }}
		</p>
	</div>

	<!-- Website url -->
	<div class="mb-3">
		<fluent-text-field
			style="width: 100%"
			[value]="editProfileDialogWebsiteUrl"
			[placeholder]="locale.editProfileDialog.websiteUrlTextfieldPlaceholder"
			(input)="editProfileDialogWebsiteUrl = $event.target.value; editProfileDialogWebsiteUrlError = ''"
			(keydown.enter)="SaveProfile()">
			{{ locale.editProfileDialog.websiteUrlTextfieldLabel }}
		</fluent-text-field>

		<p class="text-field-error" *ngIf="editProfileDialogWebsiteUrlError.length > 0">
			{{ editProfileDialogWebsiteUrlError }}
		</p>
	</div>

	<!-- Facebook username -->
	<div class="mb-3">
		<fluent-text-field
			style="width: 100%"
			[value]="editProfileDialogFacebookUsername"
			[placeholder]="locale.editProfileDialog.facebookUsernameTextfieldPlaceholder"
			(input)="editProfileDialogFacebookUsername = $event.target.value; editProfileDialogFacebookUsernameError = ''"
			(keydown.enter)="SaveProfile()">
			{{ locale.editProfileDialog.facebookUsernameTextfieldLabel }}
		</fluent-text-field>

		<p class="text-field-error" *ngIf="editProfileDialogFacebookUsernameError.length > 0">
			{{ editProfileDialogFacebookUsernameError }}
		</p>
	</div>

	<!-- Instagram username -->
	<div class="mb-3">
		<fluent-text-field
			style="width: 100%"
			[value]="editProfileDialogInstagramUsername"
			[placeholder]="locale.editProfileDialog.instagramUsernameTextfieldPlaceholder"
			(input)="editProfileDialogInstagramUsername = $event.target.value; editProfileDialogInstagramUsernameError = ''"
			(keydown.enter)="SaveProfile()">
			{{ locale.editProfileDialog.instagramUsernameTextfieldLabel }}
		</fluent-text-field>

		<p class="text-field-error" *ngIf="editProfileDialogInstagramUsernameError.length > 0">
			{{ editProfileDialogInstagramUsernameError }}
		</p>
	</div>

	<!-- Twitter username -->
	<div class="mb-3">
		<fluent-text-field
			style="width: 100%"
			[value]="editProfileDialogTwitterUsername"
			[placeholder]="locale.editProfileDialog.twitterUsernameTextfieldPlaceholder"
			(input)="editProfileDialogTwitterUsername = $event.target.value; editProfileDialogTwitterUsernameError = ''"
			(keydown.enter)="SaveProfile()">
			{{ locale.editProfileDialog.twitterUsernameTextfieldLabel }}
		</fluent-text-field>

		<p class="text-field-error" *ngIf="editProfileDialogTwitterUsernameError.length > 0">
			{{ editProfileDialogTwitterUsernameError }}
		</p>
	</div>
</dav-dialog>