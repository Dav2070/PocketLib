<!-- Normal layout -->
<div
	class="ms-motion-slideUpIn row mx-2 mt-4 mb-3"
	*ngIf="!showMobileLayout && !dualScreenLayout">

	<div class="col-4 col-lg-3 offset-lg-1 mt-2 d-flex">
		<div class="mx-auto">
			<!-- Cover -->
			<pocketlib-blurhash-image
				[src]="coverContent"
				[fallback]="dataService.defaultStoreBookCover"
				[blurhash]="book.coverBlurhash"
				[title]="book.title"
				[alt]="coverAlt"
				width="160"
				height="270"
				shadow="true">
			</pocketlib-blurhash-image>

			<!-- Author profile image and name -->
			<a class="d-flex my-3"
				style="text-decoration: none;"
				[routerLink]="'/store/author/' + author.uuid">

				<pocketlib-blurhash-image
					[src]="authorProfileImageContent"
					[fallback]="dataService.defaultProfileImageUrl"
					[blurhash]="author.profileImageBlurhash"
					[title]="author.firstName + ' ' + author.lastName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
					shadowSm="true"
					rounded="true"
					cursor="true">
				</pocketlib-blurhash-image>

				<p class="font-weight-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px">
					{{ author.firstName }} {{ author.lastName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!book.purchased && book.price > 0">
				<dav-button
					(click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Read now / continue reading button -->
			<div class="mt-2" style="min-width: 194px">
				<dav-button
					type="accent"
					(click)="Read()">
					{{ book.inLibrary ? locale.continueReading : locale.readNow }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && book.status != 2">
				<p class="mt-3 mb-2 text-color">{{ bookStatus }}</p>

				<div class="d-flex">
					<dav-button
						type="accent"
						[disabled]="publishLoading"
						(click)="PublishStoreBook()"
						*ngIf="book.status == 1">
						{{ locale.publish }}
					</dav-button>

					<fluent-progress-ring
						style="margin: 8px 0px 0px 14px; width: 16px; height: 16px"
						*ngIf="publishLoading">
					</fluent-progress-ring>
				</div>
			</div>
		</div>
	</div>

	<!-- Title and back button -->
	<div class="col-8 col-lg-7">
		<div class="mt-1 mb-4 px-4">
			<dav-header
				[header]="book.title"
				backButtonVisible
				(backButtonClick)="BackButtonClick()">
			</dav-header>
		</div>

		<div style="max-width: 600px" class="mx-auto px-4">
			<!-- Description -->
			<p class="mb-1 text-color" style="white-space: pre-wrap">{{ book.description }}</p>

			<!-- Categories -->
			<a class="badge badge-pill mr-2 cursor"
				[ngClass]="i == 0 ? 'badge-primary' : 'badge-secondary'"
				style="font-size: 13px"
				[routerLink]="'/store/category/' + category.key"
				*ngFor="let category of book.categories; let i = index">
				{{ category.name }}
			</a>
		</div>
	</div>

	<div
		class="offset-lg-1 col-12 col-lg-10"
		style="margin-top: 4rem"
		[style.borderTop]="dataService.darkTheme ? '1px solid #4e4e4e' : '1px solid #c1c1c1'">
	</div>

	<!-- List of books of the series -->
	<div
		class="offset-lg-1 col-12 col-lg-10"
		style="padding: 0px 15px; margin-top: 2.5rem"
		*ngIf="book.series.length > 0">

		<pocketlib-horizontal-book-list
			type="series"
			[series]="book.series[0]"
			[currentBookUuid]="uuid">
		</pocketlib-horizontal-book-list>
	</div>

	<!-- List of books with the same categories -->
	<div
		class="offset-lg-1 col-12 col-lg-10"
		style="padding: 0px 15px"
		[style.marginTop.rem]="book.series.length > 0 ? 0 : 5">

		<pocketlib-horizontal-book-list
			type="categories"
			[currentBookUuid]="uuid"
			[categories]="categoryKeys">
		</pocketlib-horizontal-book-list>
	</div>
</div>

<!-- Dual-Screen layout -->
<div
	class="ms-motion-slideUpIn mb-3"
	style="display: grid; grid-template-rows: auto"
	[style.gridTemplateColumns]="'auto ' + (width / 2) + 'px'"
	*ngIf="!showMobileLayout && dualScreenLayout">

	<!-- Left screen -->
	<div
		class="d-flex justify-content-center"
		style="grid-row: 1; grid-column: 1;"
		[style.marginRight.px]="dualScreenFoldMargin">

		<div class="mt-4">
			<!-- Cover -->
			<pocketlib-blurhash-image
				[src]="coverContent"
				[fallback]="dataService.defaultStoreBookCover"
				[blurhash]="book.coverBlurhash"
				[title]="book.title"
				[alt]="coverAlt"
				width="160"
				height="270"
				shadow="true">
			</pocketlib-blurhash-image>

			<!-- Author profile image and name -->
			<a class="d-flex my-3"
				style="text-decoration: none;"
				[routerLink]="'/store/author/' + author.uuid">

				<pocketlib-blurhash-image
					[src]="authorProfileImageContent"
					[fallback]="dataService.defaultProfileImageUrl"
					[blurhash]="author.profileImageBlurhash"
					[title]="author.firstName + ' ' + author.lastName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
					shadowSm="true"
					rounded="true"
					cursor="true">
				</pocketlib-blurhash-image>

				<p class="font-weight-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px">
					{{ author.firstName }} {{ author.lastName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!book.purchased && book.price > 0">
				<dav-button
					(click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Read now / continue reading button -->
			<div class="mt-2" style="min-width: 194px">
				<dav-button
					type="accent"
					(click)="Read()">
					{{ book.inLibrary ? locale.continueReading : locale.readNow }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && book.status != 2">
				<p class="mt-3 mb-2 text-color">{{ bookStatus }}</p>

				<div class="d-flex">
					<dav-button
						type="accent"
						[disabled]="publishLoading"
						(click)="PublishStoreBook()"
						*ngIf="book.status == 1">
						{{ locale.publish }}
					</dav-button>

					<fluent-progress-ring
						style="margin: 8px 0px 0px 14px; width: 16px; height: 16px"
						*ngIf="publishLoading">
					</fluent-progress-ring>
				</div>
			</div>
		</div>
	</div>

	<!-- Right screen -->
	<div
		class="px-5"
		style="grid-row: 1; grid-column: 2;"
		[style.marginLeft.px]="dualScreenFoldMargin">

		<!-- Title and back button -->
		<div class="mx-auto mt-4">
			<div class="mt-1 mb-4">
				<dav-header
					[header]="book.title"
					backButtonVisible
					(backButtonClick)="BackButtonClick()">
				</dav-header>
			</div>

			<!-- Description -->
			<p class="mb-1 text-color" style="white-space: pre-wrap">{{ book.description }}</p>

			<!-- Categories -->
			<a class="badge badge-pill mr-2 cursor"
				[ngClass]="i == 0 ? 'badge-primary' : 'badge-secondary'"
				style="font-size: 13px"
				[routerLink]="'/store/category/' + category.key"
				*ngFor="let category of book.categories; let i = index">
				{{ category.name }}
			</a>
		</div>

		<div
			class="mx-3"
			style="margin-top: 3.5rem"
			[style.borderTop]="dataService.darkTheme ? '1px solid #4e4e4e' : '1px solid #c1c1c1'">
		</div>

		<div style="margin-top: 2.5rem" *ngIf="book.series.length > 0">
			<pocketlib-horizontal-book-list
				type="series"
				[series]="book.series[0]"
				[currentBookUuid]="uuid">
			</pocketlib-horizontal-book-list>
		</div>

		<div [style.marginTop.rem]="book.series.length > 0 ? 0 : 5">
			<pocketlib-horizontal-book-list
				type="categories"
				[currentBookUuid]="uuid"
				[categories]="categoryKeys">
			</pocketlib-horizontal-book-list>
		</div>
	</div>
</div>

<!-- Mobile layout -->
<div
	class="container ms-motion-slideUpIn mb-3"
	*ngIf="showMobileLayout">

	<!-- Title and back button -->
	<div class="mt-3 mb-4">
		<dav-header
			[header]="book.title"
			backButtonVisible
			(backButtonClick)="BackButtonClick()">
		</dav-header>
	</div>

	<div class="d-flex">
		<div class="mx-auto">
			<!-- Cover -->
			<pocketlib-blurhash-image
				[src]="coverContent"
				[fallback]="dataService.defaultStoreBookCover"
				[blurhash]="book.coverBlurhash"
				[title]="book.title"
				[alt]="coverAlt"
				width="160"
				height="270"
				shadow="true">
			</pocketlib-blurhash-image>

			<!-- Author profile image and name -->
			<a class="d-flex my-3"
				style="text-decoration: none;"
				[routerLink]="'/store/author/' + author.uuid">

				<pocketlib-blurhash-image
					[src]="authorProfileImageContent"
					[fallback]="dataService.defaultProfileImageUrl"
					[blurhash]="author.profileImageBlurhash"
					[title]="author.firstName + ' ' + author.lastName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
					shadowSm="true"
					rounded="true"
					cursor="true">
				</pocketlib-blurhash-image>

				<p class="font-weight-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px">
					{{ author.firstName }} {{ author.lastName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!book.purchased && book.price > 0">
				<dav-button
					(click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Read now / continue reading button -->
			<div class="mt-2" style="min-width: 194px">
				<dav-button
					type="accent"
					(click)="Read()">
					{{ book.inLibrary ? locale.continueReading : locale.readNow }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && book.status != 2">
				<p class="mt-3 mb-2 text-color">{{ bookStatus }}</p>

				<div class="d-flex">
					<dav-button
						type="accent"
						[disabled]="publishLoading"
						(click)="PublishStoreBook()"
						*ngIf="book.status == 1">
						{{ locale.publish }}
					</dav-button>

					<fluent-progress-ring
						style="margin: 8px 0px 0px 14px; width: 16px; height: 16px"
						*ngIf="publishLoading">
					</fluent-progress-ring>
				</div>
			</div>
		</div>
	</div>

	<!-- Description -->
	<p class="mt-4 mb-1 text-color" style="white-space: pre-line">{{ book.description }}</p>

	<!-- Categories -->
	<a class="badge badge-pill mr-2 cursor"
		[ngClass]="i == 0 ? 'badge-primary' : 'badge-secondary'"
		style="font-size: 13px"
		[routerLink]="'/store/category/' + category.key"
		*ngFor="let category of book.categories; let i = index">
		{{ category.name }}
	</a>

	<div
		class="mx-3"
		style="margin-top: 3.5rem"
		[style.borderTop]="dataService.darkTheme ? '1px solid #4e4e4e' : '1px solid #c1c1c1'">
	</div>

	<div style="margin-top: 2.5rem" *ngIf="book.series.length > 0">
		<pocketlib-horizontal-book-list
			type="series"
			[series]="book.series[0]"
			[currentBookUuid]="uuid">
		</pocketlib-horizontal-book-list>
	</div>

	<div [style.marginTop.rem]="book.series.length > 0 ? 0 : 5">
		<pocketlib-horizontal-book-list
			type="categories"
			[currentBookUuid]="uuid"
			[categories]="categoryKeys">
		</pocketlib-horizontal-book-list>
	</div>
</div>

<pocketlib-loading-screen
	*ngIf="loadingScreenVisible">
</pocketlib-loading-screen>

<dav-dialog
	[header]="locale.loginRequiredDialog.header"
	[primaryButtonText]="locale.learnMore"
	[defaultButtonText]="locale.close"
	[visible]="loginRequiredDialogVisible"
	maxWidth="340"
	(dismiss)="loginRequiredDialogVisible = false"
	(primaryButtonClick)="NavigateToAccountPage()"
	(defaultButtonClick)="loginRequiredDialogVisible = false">

	<p class="text-color">{{ locale.loginRequiredDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[header]="locale.noAccessDialog.header"
	[primaryButtonText]="locale.learnMore"
	[defaultButtonText]="locale.close"
	[visible]="noAccessDialogVisible"
	maxWidth="340"
	(dismiss)="noAccessDialogVisible = false"
	(primaryButtonClick)="NavigateToAccountPage()"
	(defaultButtonClick)="noAccessDialogVisible = false">

	<p class="text-color">{{ locale.noAccessDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[header]="locale.buyBookDialog.header"
	[primaryButtonText]="locale.buyBookDialog.continue"
	[defaultButtonText]="locale.cancel"
	[visible]="buyBookDialogVisible"
	maxWidth="400"
	(dismiss)="buyBookDialogVisible = false"
	(primaryButtonClick)="buyBookDialogLoginRequired ? NavigateToAccountPage() : NavigateToPurchasePage()"
	(defaultButtonClick)="buyBookDialogVisible = false">

	<p class="text-color"
		[innerHTML]="buyBookDialogLoginRequired ? locale.buyBookDialog.descriptionNotLoggedIn : locale.buyBookDialog.description">
	</p>
</dav-dialog>

<dav-dialog
	[header]="locale.errorDialog.header"
	[defaultButtonText]="locale.close"
	[visible]="errorDialogVisible"
	maxWidth="340"
	(dismiss)="errorDialogVisible = false"
	(defaultButtonClick)="errorDialogVisible = false">

	<p class="text-color">{{ locale.errorDialog.description }}</p>
</dav-dialog>