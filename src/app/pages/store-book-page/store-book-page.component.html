<!-- Normal layout -->
<div
	#container
	class="ms-motion-slideUpIn row mx-2 mt-4 mb-3"
	*ngIf="!showMobileLayout && !dualScreenLayout">

	<div class="col-4 col-lg-3 offset-lg-1 mt-2 d-flex">
		<div class="mx-auto">
			<!-- Cover -->
			<pocketlib-blurhash-image
				[src]="coverContent"
				[fallback]="dataService.defaultStoreBookCover"
				[blurhash]="book.coverBlurhash"
				[title]="book.title"
				[alt]="coverAlt"
				width="160"
				height="270"
				shadow="true">
			</pocketlib-blurhash-image>

			<!-- Author profile image and name -->
			<a class="d-flex my-3"
				style="text-decoration: none;"
				[routerLink]="'/store/author/' + author.uuid">

				<pocketlib-blurhash-image
					[src]="authorProfileImageContent"
					[fallback]="dataService.defaultProfileImageUrl"
					[blurhash]="author.profileImageBlurhash"
					[title]="author.firstName + ' ' + author.lastName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
					shadowSm="true"
					rounded="true"
					cursor="true">
				</pocketlib-blurhash-image>

				<p class="font-weight-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px">
					{{ author.firstName }} {{ author.lastName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!book.purchased">
				<dav-button
					(click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Add to library button -->
			<div class="mt-2" style="min-width: 194px" *ngIf="!(book.price == 0 && !this.book.purchased)">
				<dav-button
					type="accent"
					[disabled]="addToLibraryButtonDisabled"
					(click)="AddToLibrary()">
					{{ locale.addToLibrary }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && book.status != 2">
				<p class="mt-3 mb-2 text-color">{{ bookStatus }}</p>

				<dav-button
					(click)="PublishStoreBook()"
					*ngIf="book.status == 1">
					{{ locale.publish }}
				</dav-button>
			</div>
		</div>
	</div>

	<!-- Title and back button -->
	<div class="col-8 col-lg-7">
		<div class="mb-4 px-4">
			<pocketlib-header
				[title]="book.title"
				[backButtonLink]="backButtonLink"
				[backButtonLinkParams]="backButtonLinkParams"
				(backButtonClick)="BackButtonClick()">
			</pocketlib-header>
		</div>

		<div style="max-width: 600px" class="mx-auto px-4">
			<!-- Description -->
			<p class="mb-1 text-color" style="white-space: pre-wrap">{{ book.description }}</p>

			<!-- Categories -->
			<a
				class="badge badge-pill mr-2 cursor"
				[ngClass]="i == 0 ? 'badge-primary' : 'badge-secondary'"
				style="font-size: 13px"
				[routerLink]="'/store/category/' + category.key"
				*ngFor="let category of book.categories; let i = index">
				{{ category.name }}
			</a>
		</div>
	</div>
</div>

<!-- Dual-Screen layout -->
<div
	#container
	class="ms-motion-slideUpIn mb-3"
	style="display: grid; grid-template-rows: auto"
	[style.gridTemplateColumns]="'auto ' + (width / 2) + 'px'"
	*ngIf="!showMobileLayout && dualScreenLayout">

	<!-- Left screen -->
	<div
		class="d-flex justify-content-center"
		style="grid-row: 1; grid-column: 1;"
		[style.marginRight.px]="dualScreenFoldMargin">

		<div class="mt-4">
			<!-- Cover -->
			<pocketlib-blurhash-image
				[src]="coverContent"
				[fallback]="dataService.defaultStoreBookCover"
				[blurhash]="book.coverBlurhash"
				[title]="book.title"
				[alt]="coverAlt"
				width="160"
				height="270"
				shadow="true">
			</pocketlib-blurhash-image>

			<!-- Author profile image and name -->
			<a class="d-flex my-3"
				style="text-decoration: none;"
				[routerLink]="'/store/author/' + author.uuid">

				<pocketlib-blurhash-image
					[src]="authorProfileImageContent"
					[fallback]="dataService.defaultProfileImageUrl"
					[blurhash]="author.profileImageBlurhash"
					[title]="author.firstName + ' ' + author.lastName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
					shadowSm="true"
					rounded="true"
					cursor="true">
				</pocketlib-blurhash-image>

				<p class="font-weight-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px">
					{{ author.firstName }} {{ author.lastName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!book.purchased">
				<dav-button
					(click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Add to library button -->
			<div class="mt-2" style="min-width: 194px" *ngIf="!(book.price == 0 && !this.book.purchased)">
				<dav-button
					type="accent"
					[disabled]="addToLibraryButtonDisabled"
					(click)="AddToLibrary()">
					{{ locale.addToLibrary }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && book.status != 2">
				<p class="mt-3 mb-2 text-color">{{ bookStatus }}</p>

				<dav-button
					(click)="PublishStoreBook()"
					*ngIf="book.status == 1">
					{{ locale.publish }}
				</dav-button>
			</div>
		</div>
	</div>

	<!-- Right screen -->
	<div
		class="px-5"
		style="grid-row: 1; grid-column: 2;"
		[style.marginLeft.px]="dualScreenFoldMargin">

		<!-- Title and back button -->
		<div class="mx-auto mt-4">
			<div class="mb-4">
				<pocketlib-header
					[title]="book.title"
					[backButtonLink]="backButtonLink"
					[backButtonLinkParams]="backButtonLinkParams"
					(backButtonClick)="BackButtonClick()">
				</pocketlib-header>
			</div>

			<!-- Description -->
			<p class="mb-1 text-color" style="white-space: pre-wrap">{{ book.description }}</p>

			<!-- Categories -->
			<a
				class="badge badge-pill mr-2 cursor"
				[ngClass]="i == 0 ? 'badge-primary' : 'badge-secondary'"
				style="font-size: 13px"
				[routerLink]="'/store/category/' + category.key"
				*ngFor="let category of book.categories; let i = index">
				{{ category.name }}
			</a>
		</div>
	</div>
</div>

<!-- Mobile layout -->
<div
	#container
	class="container ms-motion-slideUpIn mb-3"
	*ngIf="showMobileLayout">

	<!-- Title and back button -->
	<div class="mt-3 mb-4">
		<pocketlib-header
			[title]="book.title"
			[backButtonLink]="backButtonLink"
			[backButtonLinkParams]="backButtonLinkParams"
			(backButtonClick)="BackButtonClick()">
		</pocketlib-header>
	</div>

	<div class="d-flex">
		<div class="mx-auto">
			<!-- Cover -->
			<pocketlib-blurhash-image
				[src]="coverContent"
				[fallback]="dataService.defaultStoreBookCover"
				[blurhash]="book.coverBlurhash"
				[title]="book.title"
				[alt]="coverAlt"
				width="160"
				height="270"
				shadow="true">
			</pocketlib-blurhash-image>

			<!-- Author profile image and name -->
			<a class="d-flex my-3"
				style="text-decoration: none;"
				[routerLink]="'/store/author/' + author.uuid">

				<pocketlib-blurhash-image
					[src]="authorProfileImageContent"
					[fallback]="dataService.defaultProfileImageUrl"
					[blurhash]="author.profileImageBlurhash"
					[title]="author.firstName + ' ' + author.lastName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
					shadowSm="true"
					rounded="true"
					cursor="true">
				</pocketlib-blurhash-image>

				<p class="font-weight-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px">
					{{ author.firstName }} {{ author.lastName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!book.purchased">
				<dav-button
					(click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Add to library button -->
			<div class="mt-2" style="min-width: 194px"  *ngIf="!(book.price == 0 && !this.book.purchased)">
				<dav-button
					type="accent"
					[disabled]="addToLibraryButtonDisabled"
					(click)="AddToLibrary()">
					{{ locale.addToLibrary }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && book.status != 2">
				<p class="mt-3 mb-2 text-color">{{ bookStatus }}</p>

				<dav-button
					(click)="PublishStoreBook()"
					*ngIf="book.status == 1">
					{{ locale.publish }}
				</dav-button>
			</div>
		</div>
	</div>

	<!-- Description -->
	<p class="mt-4 mb-1 text-color" style="white-space: pre-line">{{ book.description }}</p>

	<!-- Categories -->
	<a
		class="badge badge-pill mr-2 cursor"
		[ngClass]="i == 0 ? 'badge-primary' : 'badge-secondary'"
		style="font-size: 13px"
		[routerLink]="'/store/category/' + category.key"
		*ngFor="let category of book.categories; let i = index">
		{{ category.name }}
	</a>
</div>

<dav-dialog
	[header]="locale.davProRequiredDialog.header"
	[primaryButtonText]="locale.davProRequiredDialog.learnMore"
	[defaultButtonText]="locale.back"
	[isVisible]="davProRequiredDialogVisible"
	maxWidth="340"
	(dismiss)="davProRequiredDialogVisible = false"
	(primaryButtonClick)="NavigateToAccountPage()"
	(defaultButtonClick)="davProRequiredDialogVisible = false">

	<p>{{ locale.davProRequiredDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[header]="book.price == 0 ? locale.buyBookDialog.loginRequired.headerFree : locale.buyBookDialog.header"
	[primaryButtonText]="locale.buyBookDialog.continue"
	[defaultButtonText]="locale.back"
	[isVisible]="buyBookDialogVisible"
	maxWidth="400"
	(dismiss)="buyBookDialogVisible = false"
	(primaryButtonClick)="buyBookDialogLoginRequired ? NavigateToAccountPage() : NavigateToPurchasePage()"
	(defaultButtonClick)="buyBookDialogVisible = false">

	<p [innerHTML]="buyBookDialogLoginRequired ? (book.price == 0 ? locale.buyBookDialog.loginRequired.descriptionFree : locale.buyBookDialog.loginRequired.description) : locale.buyBookDialog.description"></p>
</dav-dialog>

<dav-dialog
	[header]="locale.errorDialog.header"
	[defaultButtonText]="locale.errorDialog.ok"
	[isVisible]="errorDialogVisible"
	maxWidth="340"
	(dismiss)="errorDialogVisible = false"
	(defaultButtonClick)="errorDialogVisible = false">

	<p>{{ locale.errorDialog.description }}</p>
</dav-dialog>