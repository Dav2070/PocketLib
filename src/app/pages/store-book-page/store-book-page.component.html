<div
	class="container"
	[class]="simpleLoadingScreenVisible ? '' : 'slide-up-in'"
>
	<div class="cover-panel">
		<div class="cover-panel-content">
			<!-- Cover -->
			<div class="cover-content">
				<dav-blurhash-image
					class="cover-image"
					[src]="coverContent"
					[fallbackSrc]="dataService.defaultStoreBookCover"
					[blurhash]="coverBlurhash"
					[title]="title"
					[alt]="coverAlt"
					[width]="coverWidth"
					[height]="coverHeight"
				></dav-blurhash-image>
			</div>

			<dav-profile-card
				class="author-profile-card"
				[imageSrc]="authorProfileImageContent"
				[imageFallbackSrc]="dataService.defaultProfileImageUrl"
				[imageBlurhash]="authorProfileImageBlurhash"
				[name]="authorName"
			></dav-profile-card>

			<dav-profile-card
				class="publisher-profile-card"
				[imageSrc]="publisherLogoContent"
				[imageFallbackSrc]="dataService.defaultProfileImageUrl"
				[imageBlurhash]="publisherLogoBlurhash"
				[name]="publisherName"
				*ngIf="publisherName"
			></dav-profile-card>

			<!-- Read now / continue reading button -->
			<div class="read-button-container">
				<dav-button (click)="Read()">
					{{ inLibrary ? locale.continueReading : locale.readNow }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div class="publish-button-container">
				<dav-button
					[disabled]="publishLoading"
					(click)="PublishStoreBook()"
					*ngIf="dataService.userIsAdmin && status == 1"
				>
					{{ locale.publish }}
				</dav-button>
			</div>
		</div>
	</div>

	<div class="description-panel">
		<dav-header
			size="small"
			backButtonVisible
			(backButtonClick)="BackButtonClick()"
			*ngIf="title.length > 0"
		>
			{{ title }}
		</dav-header>

		<div class="description-container">
			<!-- Description -->
			<p class="book-description">
				{{ description }}
			</p>

			<!-- Categories -->
			<div class="category-badge-container">
				<dav-badge
					[color]="i == 0 ? 'primary' : 'secondary'"
					tonal
					*ngFor="let category of categories; let i = index"
				>
					{{ category.name }}
				</dav-badge>
			</div>
		</div>
	</div>
</div>

<!-- Normal layout -->
<div
	class="row mx-2 my-3"
	[class]="simpleLoadingScreenVisible ? '' : 'slide-up-in'"
	*ngIf="!showMobileLayout"
>
	<div class="col-4 col-lg-3 offset-lg-1 mt-2 d-flex">
		<div class="mx-auto">
			<!-- Cover -->
			<dav-blurhash-image
				class="cover-image"
				[src]="coverContent"
				[fallbackSrc]="dataService.defaultStoreBookCover"
				[blurhash]="coverBlurhash"
				[title]="title"
				[alt]="coverAlt"
				[width]="coverWidth"
				[height]="coverHeight"
			></dav-blurhash-image>

			<!-- Author profile image and name -->
			<a
				class="d-flex my-3"
				style="text-decoration: none"
				[routerLink]="'/store/author/' + authorUuid"
			>
				<dav-blurhash-image
					style="border-radius: 50%"
					[src]="authorProfileImageContent"
					[fallbackSrc]="dataService.defaultProfileImageUrl"
					[blurhash]="authorProfileImageBlurhash"
					[title]="authorName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
				></dav-blurhash-image>

				<p
					class="fw-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px"
				>
					{{ authorName }}
				</p>
			</a>

			<!-- Publisher profile and name -->
			<a
				class="d-flex my-3"
				style="text-decoration: none"
				[routerLink]="'/store/publisher/' + publisherUuid"
				*ngIf="publisherName"
			>
				<dav-blurhash-image
					style="border-radius: 50%"
					[src]="publisherLogoContent"
					[fallbackSrc]="dataService.defaultProfileImageUrl"
					[blurhash]="publisherLogoBlurhash"
					[title]="publisherName"
					[alt]="publisherLogoAlt"
					width="30"
					height="30"
				></dav-blurhash-image>

				<p
					class="fw-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px"
				>
					{{ publisherName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!purchased && price > 0">
				<dav-button (click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Read now / continue reading button -->
			<div class="mt-2" style="min-width: 194px">
				<dav-button type="accent" (click)="Read()">
					{{ inLibrary ? locale.continueReading : locale.readNow }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && status != 2">
				<p class="mt-3 mb-2 text-color">
					{{ bookStatus }}
				</p>

				<div class="d-flex">
					<dav-button
						type="accent"
						[disabled]="publishLoading"
						(click)="PublishStoreBook()"
						*ngIf="status == 1"
					>
						{{ locale.publish }}
					</dav-button>

					<dav-progress-ring
						style="margin: 8px 0px 0px 14px"
						size="16"
						*ngIf="publishLoading"
					></dav-progress-ring>
				</div>
			</div>
		</div>
	</div>

	<!-- Title and back button -->
	<div class="col-8 col-lg-7">
		<div class="mt-1 mb-4 px-4">
			<dav-header
				size="small"
				backButtonVisible
				(backButtonClick)="BackButtonClick()"
				*ngIf="title.length > 0"
			>
				{{ title }}
			</dav-header>
		</div>

		<div style="max-width: 600px" class="mx-auto px-4">
			<!-- Description -->
			<p class="book-description mb-1 text-color">
				{{ description }}
			</p>

			<!-- Categories -->
			<div class="category-badge-container">
				<dav-badge
					[color]="i == 0 ? 'primary' : 'secondary'"
					tonal
					*ngFor="let category of categories; let i = index"
				>
					{{ category.name }}
				</dav-badge>
			</div>
		</div>
	</div>

	<div
		class="offset-lg-1 col-12 col-lg-10"
		style="margin-top: 4rem"
		[style.borderTop]="
			dataService.darkTheme ? '1px solid #4e4e4e' : '1px solid #c1c1c1'
		"
	></div>

	<!-- List of books of the series -->
	<div
		class="offset-lg-1 col-12 col-lg-10"
		style="padding: 0px 15px; margin-top: 2.5rem"
		*ngIf="seriesUuid != null"
	>
		<pocketlib-horizontal-book-list
			type="series"
			[series]="seriesUuid"
			[currentBookUuid]="uuid"
		></pocketlib-horizontal-book-list>
	</div>

	<!-- List of books with the same categories -->
	<div
		class="offset-lg-1 col-12 col-lg-10"
		style="padding: 0px 15px; margin-top: 2.5rem"
	>
		<pocketlib-horizontal-book-list
			type="categories"
			[currentBookUuid]="uuid"
			[categories]="categoryKeys"
		></pocketlib-horizontal-book-list>
	</div>
</div>

<!-- Mobile layout -->
<div
	class="container my-3"
	[class]="simpleLoadingScreenVisible ? '' : 'slide-up-in'"
	*ngIf="showMobileLayout"
>
	<!-- Title and back button -->
	<div class="mt-3 mb-4">
		<dav-header
			size="small"
			backButtonVisible
			(backButtonClick)="BackButtonClick()"
			*ngIf="title.length > 0"
		>
			{{ title }}
		</dav-header>
	</div>

	<div class="d-flex">
		<div class="mx-auto">
			<!-- Cover -->
			<dav-blurhash-image
				class="cover-image"
				[src]="coverContent"
				[fallbackSrc]="dataService.defaultStoreBookCover"
				[blurhash]="coverBlurhash"
				[title]="title"
				[alt]="coverAlt"
				[width]="coverWidth"
				[height]="coverHeight"
			></dav-blurhash-image>

			<!-- Author profile image and name -->
			<a
				class="d-flex my-3"
				style="text-decoration: none"
				[routerLink]="'/store/author/' + authorUuid"
			>
				<dav-blurhash-image
					style="border-radius: 50%"
					[src]="authorProfileImageContent"
					[fallbackSrc]="dataService.defaultProfileImageUrl"
					[blurhash]="authorProfileImageBlurhash"
					[title]="authorName"
					[alt]="authorProfileImageAlt"
					width="30"
					height="30"
				></dav-blurhash-image>

				<p
					class="fw-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px"
				>
					{{ authorName }}
				</p>
			</a>

			<!-- Publisher profile and name -->
			<a
				class="d-flex my-3"
				style="text-decoration: none"
				[routerLink]="'/store/publisher/' + publisherUuid"
				*ngIf="publisherName"
			>
				<dav-blurhash-image
					style="border-radius: 50%"
					[src]="publisherLogoContent"
					[fallbackSrc]="dataService.defaultProfileImageUrl"
					[blurhash]="publisherLogoBlurhash"
					[title]="publisherName"
					[alt]="publisherLogoAlt"
					width="30"
					height="30"
				></dav-blurhash-image>

				<p
					class="fw-light my-auto cursor text-color"
					style="font-size: 18px; margin-left: 13px"
				>
					{{ publisherName }}
				</p>
			</a>

			<!-- Buy button -->
			<div *ngIf="!purchased && price > 0">
				<dav-button (click)="BuyBook()">
					{{ price }}
				</dav-button>
			</div>

			<!-- Read now / continue reading button -->
			<div class="mt-2" style="min-width: 194px">
				<dav-button type="accent" (click)="Read()">
					{{ inLibrary ? locale.continueReading : locale.readNow }}
				</dav-button>
			</div>

			<!-- Status and Publish button (only for admins) -->
			<div *ngIf="dataService.userIsAdmin && status != 2">
				<p class="mt-3 mb-2 text-color">{{ bookStatus }}</p>

				<div class="d-flex">
					<dav-button
						type="accent"
						[disabled]="publishLoading"
						(click)="PublishStoreBook()"
						*ngIf="status == 1"
					>
						{{ locale.publish }}
					</dav-button>

					<dav-progress-ring
						style="margin: 8px 0px 0px 14px"
						size="16"
						*ngIf="publishLoading"
					></dav-progress-ring>
				</div>
			</div>
		</div>
	</div>

	<!-- Description -->
	<p class="book-description mt-4 mb-1 text-color">
		{{ description }}
	</p>

	<!-- Categories -->
	<div class="category-badge-container">
		<dav-badge
			[color]="i == 0 ? 'primary' : 'secondary'"
			tonal
			*ngFor="let category of categories; let i = index"
		>
			{{ category.name }}
		</dav-badge>
	</div>

	<div
		class="mx-3"
		style="margin-top: 3.5rem"
		[style.borderTop]="
			dataService.darkTheme ? '1px solid #4e4e4e' : '1px solid #c1c1c1'
		"
	></div>

	<div style="margin-top: 2.5rem" *ngIf="seriesUuid != null">
		<pocketlib-horizontal-book-list
			type="series"
			[series]="seriesUuid"
			[currentBookUuid]="uuid"
		></pocketlib-horizontal-book-list>
	</div>

	<div style="margin-top: 2.5rem">
		<pocketlib-horizontal-book-list
			type="categories"
			[currentBookUuid]="uuid"
			[categories]="categoryKeys"
		></pocketlib-horizontal-book-list>
	</div>
</div>

<pocketlib-loading-screen *ngIf="loadingScreenVisible">
</pocketlib-loading-screen>

<pocketlib-simple-loading-screen *ngIf="simpleLoadingScreenVisible">
</pocketlib-simple-loading-screen>

<dav-dialog
	[headline]="locale.loginRequiredDialog.headline"
	[primaryButtonText]="locale.learnMore"
	[defaultButtonText]="locale.close"
	[visible]="loginRequiredDialogVisible"
	maxWidth="340"
	(dismiss)="loginRequiredDialogVisible = false"
	(primaryButtonClick)="NavigateToAccountPage()"
	(defaultButtonClick)="loginRequiredDialogVisible = false"
>
	<p class="text-color">{{ locale.loginRequiredDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[headline]="locale.noAccessDialog.headline"
	[primaryButtonText]="locale.learnMore"
	[defaultButtonText]="locale.close"
	[visible]="noAccessDialogVisible"
	maxWidth="340"
	(dismiss)="noAccessDialogVisible = false"
	(primaryButtonClick)="NavigateToAccountPage()"
	(defaultButtonClick)="noAccessDialogVisible = false"
>
	<p class="text-color">{{ locale.noAccessDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[headline]="locale.buyBookDialog.headline"
	[primaryButtonText]="locale.buyBookDialog.continue"
	[defaultButtonText]="locale.cancel"
	[visible]="buyBookDialogVisible"
	maxWidth="400"
	(dismiss)="buyBookDialogVisible = false"
	(primaryButtonClick)="
		buyBookDialogLoginRequired
			? NavigateToAccountPage()
			: NavigateToPurchasePage()
	"
	(defaultButtonClick)="buyBookDialogVisible = false"
>
	<p
		class="text-color"
		[innerHTML]="
			buyBookDialogLoginRequired
				? locale.buyBookDialog.descriptionNotLoggedIn
				: locale.buyBookDialog.description
		"
	></p>
</dav-dialog>

<dav-dialog
	[headline]="locale.errorDialog.headline"
	[defaultButtonText]="locale.close"
	[visible]="errorDialogVisible"
	maxWidth="340"
	(dismiss)="errorDialogVisible = false"
	(defaultButtonClick)="errorDialogVisible = false"
>
	<p class="text-color">{{ locale.errorDialog.description }}</p>
</dav-dialog>
