<!-- Normal layout -->
<div
	class="container ms-motion-slideUpIn"
	[style.paddingBottom.px]="dataService.bottomToolbarVisible ? 56 : 0"
	*ngIf="!dualScreenLayout">

	<h1 class="text-center font-weight-light mt-3 text-color">{{ locale.title }}</h1>

   <div class="my-3" *ngIf="!loading">
		<div
			class="d-flex"
			*ngIf="dataService.books.length == 0">

			<div class="mx-auto" style="width: 100%; height: 100%; max-width: 600px">
				<p class="font-weight-light text-center text-color mt-2 mb-3"
					style="font-size: 19px">
					{{ locale.libraryEmpty }}
				</p>

				<pocketlib-library-page-cards
					(addBookFilePick)="AddBookFilePick($event)">
				</pocketlib-library-page-cards>
			</div>
		</div>

		<div *ngIf="dataService.books.length > 0">
			<div class="d-flex justify-content-center my-3">
				<!-- Card for adding new book -->
				<button
					class="card cursor mx-3 d-flex justify-content-center align-items-center theme-background-color-secondary"
					style="width: 140px; transition: 0.12s"
					[ngClass]="addBookHover ? 'shadow' : 'shadow-sm'"
					ngxFilePicker
					accept="application/epub+zip"
					(filePick)="AddBookFilePick($event)"
					(mouseover)="addBookHover = true"
					(mouseout)="addBookHover = false"
					(focusin)="addBookHover = true"
					(focusout)="addBookHover = false"
					*ngIf="dataService.books.length > 0">

					<div class="card-body d-flex align-items-center" style="padding: 1rem">
						<i class="ms-Icon ms-Icon--Add text-color"
							aria-hidden="true"
							style="font-size: 24px">
						</i>
					</div>
				</button>

				<!-- Card for discovering books in the Store -->
				<a
					class="card cursor mx-3 d-flex justify-content-center align-items-center theme-background-color-secondary"
					style="width: 140px; text-decoration: none; transition: 0.12s"
					[ngClass]="discoverBooksHover ? 'shadow' : 'shadow-sm'"
					routerLink="/store"
					(mouseover)="discoverBooksHover = true"
					(mouseout)="discoverBooksHover = false"
					(focusin)="discoverBooksHover = true"
					(focusout)="discoverBooksHover = false">

					<div class="card-body d-flex align-items-center" style="padding: 1rem">
						<i class="ms-Icon ms-Icon--Shop text-color"
							aria-hidden="true"
							style="font-size: 24px">
						</i>
					</div>
				</a>

				<!-- Card for going to the author page, if the user is an author -->
				<a
					class="card cursor mx-3 d-flex justify-content-center align-items-center theme-background-color-secondary"
					style="width: 140px; text-decoration: none; transition: 0.12s"
					[ngClass]="goToAuthorPageHover ? 'shadow' : 'shadow-sm'"
					routerLink="/author"
					*ngIf="dataService.userAuthor || dataService.userIsAdmin"
					(mouseover)="goToAuthorPageHover = true"
					(mouseout)="goToAuthorPageHover = false"
					(focusin)="goToAuthorPageHover = true"
					(focusout)="goToAuthorPageHover = false">

					<div class="card-body d-flex align-items-center" style="padding: 1rem">
						<fa-icon
							class="text-color"
							style="font-size: 24px"
							[icon]="faAddressCard">
						</fa-icon>
					</div>
				</a>
			</div>

			<div class="row justify-content-center">
				<pocketlib-library-page-book-card
					*ngFor="let book of dataService.books; let i = index"
					[book]="book"
					[width]="bookCoverWidth"
					(click)="ShowBook(book)"
					(contextMenu)="BookContextMenu($event, book)">
				</pocketlib-library-page-book-card>
			</div>
		</div>
	</div>

	<fluent-progress-ring
		class="mx-auto"
		style="width: 32px; height: 32px; margin-top: 36px"
		*ngIf="loading">
	</fluent-progress-ring>
</div>

<!-- Dual-Screen layout -->
<div
	class="d-flex flex-row ms-motion-slideUpIn"
	*ngIf="dualScreenLayout">

	<!-- Left screen -->
	<div
		class="w-50"
		[style.marginRight.px]="dualScreenFoldMargin">

		<h1 class="text-center font-weight-light mt-3 text-color">{{ locale.title }}</h1>

		<div class="mx-auto px-5">
			<pocketlib-library-page-cards
				(addBookFilePick)="AddBookFilePick($event)">
			</pocketlib-library-page-cards>
		</div>
	</div>

	<!-- Right screen -->
	<div
		class="w-50"
		[style.marginLeft.px]="dualScreenFoldMargin">

		<div
			class="row justify-content-center pt-3"
			style="overflow: scroll"
			[style.height.px]="dataService.contentHeight">

			<pocketlib-library-page-book-card
				*ngFor="let book of dataService.books"
				[book]="book"
				(click)="ShowBook(book)"
				(contextMenu)="BookContextMenu($event, book)">
			</pocketlib-library-page-book-card>
		</div>
	</div>
</div>

<div
	#contextMenu 
	class="dropdown-menu shadow-sm ms-motion-slideDownIn theme-background-color-tertiary" 
	[ngClass]="contextMenuVisible ? 'show' : ''"
	style="position: absolute;" 
	[style.left.px]="contextMenuPositionX" 
	[style.top.px]="contextMenuPositionY">

	<!-- Export -->
	<button
		class="dropdown-item d-flex cursor"
		style="padding-left: 10px; padding-right: 10px"
		*ngIf="showExportBookOption"
		(click)="DownloadBook()">

		<i class="ms-Icon ms-Icon--Export text-color"
			aria-hidden="true"
			style="font-size: 16px; margin-right: 10px; margin-top: 2px">
		</i>

		<span
			class="text-color"
			style="margin-top: 3px; margin-bottom: 2px">
			{{ locale.bookContextMenuExport }}
		</span>
	</button>

	<div
		class="mx-2 my-1"
		style="border-top: 1px solid #8e8e8e"
		*ngIf="showExportBookOption">
	</div>

	<!-- Rename -->
	<button
		class="dropdown-item d-flex cursor"
		style="padding-left: 10px; padding-right: 10px"
		*ngIf="showRenameBookOption"
		(click)="ShowRenameBookDialog()">

		<i class="ms-Icon ms-Icon--Edit text-color"
			aria-hidden="true"
			style="font-size: 16px; margin-right: 10px; margin-top: 2px">
		</i>

		<span
			class="text-color"
			style="margin-top: 3px; margin-bottom: 2px">
			{{ locale.bookContextMenuRename }}
		</span>
	</button>

	<!-- Remove -->
	<button
		class="dropdown-item d-flex cursor"
		style="padding-left: 10px; padding-right: 10px"
		(click)="ShowRemoveBookDialog()">

		<i class="ms-Icon ms-Icon--Delete text-color"
			aria-hidden="true"
			style="font-size: 16px; margin-right: 10px; margin-top: 2px">
		</i>

		<span
			class="text-color"
			style="margin-top: 3px; margin-bottom: 2px">
			{{ locale.bookContextMenuRemove }}
		</span>
	</button>
</div>

<dav-dialog
	[title]="locale.renameBookDialog.title"
	[primaryButtonText]="locale.save"
	[defaultButtonText]="locale.cancel"
	(dismiss)="renameBookDialogVisible = false"
	(primaryButtonClick)="RenameBook()"
	(defaultButtonClick)="renameBookDialogVisible = false"
	*ngIf="renameBookDialogVisible">

	<!-- Title -->
	<div class="mb-3">
		<fluent-text-field
			style="width: 100%"
			[value]="renameBookDialogTitle"
			type="text"
			[placeholder]="locale.renameBookDialog.titleTextfieldPlaceholder"
			(input)="renameBookDialogTitle = $event.target.value; renameBookDialogError = ''"
			(keydown.enter)="RenameBook()">
			{{ locale.renameBookDialog.titleTextfieldLabel }}
		</fluent-text-field>

		<p class="text-field-error" *ngIf="renameBookDialogError.length > 0">
			{{ renameBookDialogError }}
		</p>
	</div>
</dav-dialog>

<dav-dialog
	[title]="locale.removeBookDialog.title"
	[primaryButtonText]="locale.remove"
	[defaultButtonText]="locale.cancel"
	primaryButtonType="danger"
	[maxWidth]="340"
	(dismiss)="removeBookDialogVisible = false"
	(primaryButtonClick)="RemoveBook()"
	(defaultButtonClick)="removeBookDialogVisible = false"
	*ngIf="removeBookDialogVisible">

	<p>{{ locale.removeBookDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[title]="locale.loginToAccessBookDialog.title"
	[primaryButtonText]="locale.ok"
	[maxWidth]="340"
	(dismiss)="loginToAccessBookDialogVisible = false"
	(primaryButtonClick)="loginToAccessBookDialogVisible = false"
	*ngIf="loginToAccessBookDialogVisible">

	<p>{{ locale.loginToAccessBookDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[title]="locale.addBookErrorDialog.title"
	[primaryButtonText]="locale.ok"
	[maxWidth]="340"
	(dismiss)="addBookErrorDialogVisible = false"
	(primaryButtonClick)="addBookErrorDialogVisible = false"
	*ngIf="addBookErrorDialogVisible">

	<p>{{ locale.addBookErrorDialog.description }}</p>
</dav-dialog>