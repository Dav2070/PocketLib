<!-- Normal layout -->
<div class="container slide-up-in" *ngIf="!dualScreenLayout">
	<div>
		<div
			class="empty-library-container"
			*ngIf="dataService.books.length == 0"
		>
			<div class="empty-library-inner-container">
				<p class="library-empty-text">
					{{ locale.libraryEmpty }}
				</p>

				<pocketlib-library-page-cards
					(addBookFilePick)="AddBookFilePick($event)"
				></pocketlib-library-page-cards>
			</div>
		</div>

		<div
			#leftContentContainer
			class="left-content-container"
			*ngIf="dataService.books.length > 0"
		>
			<div class="quick-action-buttons-container">
				<!-- Card for discovering books in the Store -->
				<dav-icon-card
					class="quick-action-button"
					(click)="NavigateToStorePage()"
				>
					<fa-icon [icon]="faBagShoppingLight"></fa-icon>
				</dav-icon-card>

				<!-- Card for adding book file -->
				<dav-icon-card
					class="quick-action-button"
					ngxFilePicker
					accept="application/epub+zip"
					(filePick)="AddBookFilePick($event)"
					*ngIf="dataService.books.length > 0"
				>
					<fa-icon [icon]="faFileLight"></fa-icon>
				</dav-icon-card>

				<!-- Card for going to the author page, if the user is an author -->
				<dav-icon-card
					class="quick-action-button"
					(click)="NavigateToAuthorPage()"
					*ngIf="dataService.userAuthor || dataService.userIsAdmin"
				>
					<fa-icon [icon]="faAddressCardLight"></fa-icon>
				</dav-icon-card>
			</div>

			<div [ngClass]="smallBookList ? '' : 'large-book-list-container'">
				<!-- Big book card for last read book -->
				<pocketlib-library-page-book-card
					[book]="dataService.books[0]"
					[width]="largeBookCoverWidth"
					(click)="ShowBook(dataService.books[0])"
					(contextMenu)="BookContextMenu($event, dataService.books[0])"
				></pocketlib-library-page-book-card>

				<div
					class="small-book-list-container"
					[style.flexFlow]="smallBookList ? 'row wrap' : 'column wrap'"
					[style.maxHeight.px]="largeBookCoverWidth * 1.5 + 200"
					[style.width.px]="smallBookListWidth"
				>
					<div *ngFor="let book of dataService.books; let i = index">
						<pocketlib-library-page-book-card
							[book]="book"
							[width]="smallBookCoverWidth"
							(click)="ShowBook(book)"
							(contextMenu)="BookContextMenu($event, book)"
							*ngIf="i != 0 && i < 5"
						></pocketlib-library-page-book-card>
					</div>
				</div>
			</div>

			<div
				class="all-books-button-container"
				[style.justifyContent]="smallBookList ? 'center' : 'end'"
				[style.width.px]="largeBookCoverWidth + smallBookListWidth"
				*ngIf="dataService.books.length > 5"
			>
				<dav-button color="secondary" tonal (click)="ShowAllBooks()">
					<div class="all-books-button-content">
						<p>{{ locale.allBooks }}</p>

						<div>
							<fa-icon [icon]="faArrowRightLight" size="lg"></fa-icon>
						</div>
					</div>
				</dav-button>
			</div>
		</div>

		<div #rightContentContainer class="right-content-container">
			<div>
				<div class="right-content-inner-container">
					<div class="search-container">
						<dav-button color="secondary" tonal (click)="HideAllBooks()">
							<div class="all-books-button-content">
								<div>
									<fa-icon
										[icon]="faArrowLeftLight"
										size="lg"
									></fa-icon>
								</div>

								<p>{{ locale.back }}</p>
							</div>
						</dav-button>

						<dav-textfield
							class="search-textfield"
							[placeholder]="locale.search"
							(change)="SearchTextChange($event.detail.value)"
						></dav-textfield>
					</div>

					<p class="no-books-text" *ngIf="allBooks.length == 0">
						{{ locale.noBooks }}
					</p>

					<dav-list class="all-books-list">
						<dav-list-item
							[imageSrc]="book.cover"
							[imageFallbackSrc]="dataService.defaultStoreBookCover"
							[headline]="book.title"
							[subhead]="book.author"
							(click)="ShowBook(book)"
							(contextmenu)="BookContextMenu($event, book)"
							*ngFor="let book of allBooks"
						></dav-list-item>
					</dav-list>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Dual-Screen layout -->
<div class="dual-screen-container slide-up-in" *ngIf="dualScreenLayout">
	<!-- Left screen -->
	<div
		class="dual-screen-container-left"
		[style.marginRight.px]="dualScreenFoldMargin"
	>
		<div>
			<pocketlib-library-page-cards
				(addBookFilePick)="AddBookFilePick($event)"
			></pocketlib-library-page-cards>
		</div>
	</div>

	<!-- Right screen -->
	<div
		class="dual-screen-container-right"
		[style.marginLeft.px]="dualScreenFoldMargin"
	>
		<div>
			<pocketlib-library-page-book-card
				*ngFor="let book of dataService.books"
				[book]="book"
				(click)="ShowBook(book)"
				(contextMenu)="BookContextMenu($event, book)"
			></pocketlib-library-page-book-card>
		</div>
	</div>
</div>

<pocketlib-loading-screen *ngIf="loadingScreenVisible">
</pocketlib-loading-screen>

<dav-context-menu
	[visible]="contextMenuVisible"
	[posX]="contextMenuPositionX"
	[posY]="contextMenuPositionY"
>
	<!-- Export -->
	<dav-context-menu-item
		[value]="locale.bookContextMenuExport"
		(click)="DownloadBook()"
		*ngIf="showExportBookOption"
	>
		<fa-icon slot="icon" [icon]="faFileExportLight"></fa-icon>
	</dav-context-menu-item>

	<dav-context-menu-divider *ngIf="showExportBookOption">
	</dav-context-menu-divider>

	<!-- Rename -->
	<dav-context-menu-item
		[value]="locale.bookContextMenuRename"
		(click)="ShowRenameBookDialog()"
		*ngIf="showRenameBookOption"
	>
		<fa-icon slot="icon" [icon]="faPencilLight"></fa-icon>
	</dav-context-menu-item>

	<!-- Remove -->
	<dav-context-menu-item
		[value]="locale.bookContextMenuRemove"
		(click)="ShowRemoveBookDialog()"
	>
		<fa-icon slot="icon" [icon]="faTrashLight"></fa-icon>
	</dav-context-menu-item>
</dav-context-menu>

<dav-dialog
	[headline]="locale.renameBookDialog.headline"
	[primaryButtonText]="locale.save"
	[defaultButtonText]="locale.cancel"
	[visible]="renameBookDialogVisible"
	(dismiss)="renameBookDialogVisible = false"
	(primaryButtonClick)="RenameBook()"
	(defaultButtonClick)="renameBookDialogVisible = false"
>
	<form>
		<!-- Title -->
		<div class="mb-3">
			<dav-textfield
				[value]="renameBookDialogTitle"
				[label]="locale.renameBookDialog.titleTextfieldLabel"
				[placeholder]="locale.renameBookDialog.titleTextfieldPlaceholder"
				[errorMessage]="renameBookDialogError"
				(change)="
					renameBookDialogTitle = $event.detail.value;
					renameBookDialogError = ''
				"
				(enter)="RenameBook()"
			></dav-textfield>
		</div>
	</form>
</dav-dialog>

<dav-dialog
	[headline]="locale.removeBookDialog.headline"
	[primaryButtonText]="locale.remove"
	[defaultButtonText]="locale.cancel"
	[visible]="removeBookDialogVisible"
	maxWidth="340"
	(dismiss)="removeBookDialogVisible = false"
	(primaryButtonClick)="RemoveBook()"
	(defaultButtonClick)="removeBookDialogVisible = false"
>
	<p>{{ locale.removeBookDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[headline]="locale.loginToAccessBookDialog.headline"
	[primaryButtonText]="locale.loginToAccessBookDialog.login"
	[defaultButtonText]="locale.close"
	[visible]="loginToAccessBookDialogVisible"
	maxWidth="340"
	(dismiss)="loginToAccessBookDialogVisible = false"
	(primaryButtonClick)="GoToLoginPage()"
	(defaultButtonClick)="loginToAccessBookDialogVisible = false"
>
	<p>{{ locale.loginToAccessBookDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[headline]="locale.addBookErrorDialog.headline"
	[defaultButtonText]="locale.close"
	[visible]="addBookErrorDialogVisible"
	maxWidth="340"
	(dismiss)="addBookErrorDialogVisible = false"
	(defaultButtonClick)="addBookErrorDialogVisible = false"
>
	<p>{{ locale.addBookErrorDialog.description }}</p>
</dav-dialog>
