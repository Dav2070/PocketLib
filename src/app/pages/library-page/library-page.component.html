<!-- Normal layout -->
<div
	class="ms-motion-slideUpIn"
	[style.paddingBottom.px]="dataService.bottomToolbarVisible ? 56 : 0"
	*ngIf="!dualScreenLayout">

	<h1 class="text-center fw-light mt-3 text-color">{{ locale.title }}</h1>

   <div class="d-flex justify-content-center my-3" *ngIf="!loading">
		<div
			class="d-flex"
			*ngIf="dataService.books.length == 0">

			<div class="mx-auto" style="width: 100%; height: 100%; max-width: 600px">
				<p class="fw-light text-center text-color mt-2 mb-3"
					style="font-size: 19px">
					{{ locale.libraryEmpty }}
				</p>

				<pocketlib-library-page-cards
					(addBookFilePick)="AddBookFilePick($event)">
				</pocketlib-library-page-cards>
			</div>
		</div>

		<div
			#leftContentContainer
			class="d-flex flex-column align-items-center w-100"
			style="transition: 0.3s all"
			*ngIf="dataService.books.length > 0">

			<div class="d-flex justify-content-center mb-3">
				<!-- Card for adding new book -->
				<button
					class="card cursor mx-3 d-flex justify-content-center align-items-center theme-background-color-secondary"
					style="width: 140px; transition: 0.12s"
					[ngClass]="addBookHover ? 'shadow' : 'shadow-sm'"
					ngxFilePicker
					accept="application/epub+zip"
					(filePick)="AddBookFilePick($event)"
					(mouseover)="addBookHover = true"
					(mouseout)="addBookHover = false"
					(focusin)="addBookHover = true"
					(focusout)="addBookHover = false"
					*ngIf="dataService.books.length > 0">

					<div class="card-body d-flex align-items-center" style="padding: 1rem">
						<i class="ms-Icon ms-Icon--Add text-color"
							aria-hidden="true"
							style="font-size: 24px">
						</i>
					</div>
				</button>

				<!-- Card for discovering books in the Store -->
				<a class="card cursor mx-3 d-flex justify-content-center align-items-center theme-background-color-secondary"
					style="width: 140px; text-decoration: none; transition: 0.12s"
					[ngClass]="discoverBooksHover ? 'shadow' : 'shadow-sm'"
					routerLink="/store"
					(mouseover)="discoverBooksHover = true"
					(mouseout)="discoverBooksHover = false"
					(focusin)="discoverBooksHover = true"
					(focusout)="discoverBooksHover = false">

					<div class="card-body d-flex align-items-center" style="padding: 1rem">
						<i class="ms-Icon ms-Icon--Shop text-color"
							aria-hidden="true"
							style="font-size: 24px">
						</i>
					</div>
				</a>

				<!-- Card for going to the author page, if the user is an author -->
				<a class="card cursor mx-3 d-flex justify-content-center align-items-center theme-background-color-secondary"
					style="width: 140px; text-decoration: none; transition: 0.12s"
					[ngClass]="goToAuthorPageHover ? 'shadow' : 'shadow-sm'"
					routerLink="/author"
					*ngIf="dataService.userAuthor || dataService.userIsAdmin"
					(mouseover)="goToAuthorPageHover = true"
					(mouseout)="goToAuthorPageHover = false"
					(focusin)="goToAuthorPageHover = true"
					(focusout)="goToAuthorPageHover = false">

					<div class="card-body d-flex align-items-center" style="padding: 1rem">
						<fa-icon
							class="text-color"
							style="font-size: 24px"
							[icon]="faAddressCard">
						</fa-icon>
					</div>
				</a>
			</div>

			<div [ngClass]="smallBookList ? '' : 'd-flex justify-content-center'">
				<!-- Big book card for last read book -->
				<pocketlib-library-page-book-card
					[book]="dataService.books[0]"
					[width]="largeBookCoverWidth"
					(click)="ShowBook(dataService.books[0])"
					(contextMenu)="BookContextMenu($event, dataService.books[0])">
				</pocketlib-library-page-book-card>

				<div
					class="d-flex"
					[style.flexFlow]="smallBookList ? 'row wrap' : 'column wrap'"
					[style.maxHeight.px]="(largeBookCoverWidth * 1.5) + 200"
					[style.width.px]="smallBookListWidth">

					<div *ngFor="let book of dataService.books; let i = index">
						<pocketlib-library-page-book-card
							[book]="book"
							[width]="smallBookCoverWidth"
							(click)="ShowBook(book)"
							(contextMenu)="BookContextMenu($event, book)"
							*ngIf="i != 0 && i < 5">
						</pocketlib-library-page-book-card>
					</div>
				</div>
			</div>

			<div
				class="d-flex mt-3"
				[ngClass]="smallBookList ? 'justify-content-center' : 'justify-content-end'"
				[style.width.px]="largeBookCoverWidth + smallBookListWidth"
				*ngIf="dataService.books.length > 5">
				<dav-button (click)="ShowAllBooks()">
					<p style="margin-bottom: 0; margin-top: -2px">{{ locale.allBooks }}</p>
					<i class="ms-Icon ms-Icon--Forward ms-2" aria-hidden="true"></i>
				</dav-button>
			</div>
		</div>

		<div
			#rightContentContainer
			class="d-flex justify-content-center w-100"
			style="position: absolute; transition: 0.3s all; transform: translateX(3000px)">

			<div class="container">
				<div class="mx-auto" style="max-width: 700px">
					<div class="d-flex">
						<dav-button
							(click)="HideAllBooks()">
							<i class="ms-Icon ms-Icon--Back me-2" aria-hidden="true"></i>
							<p style="margin-bottom: 0; margin-top: -2px">{{ locale.back }}</p>
						</dav-button>

						<dav-textfield
							class="ms-3"
							[placeholder]="locale.search"
							(change)="SearchTextChange($event.detail.value)">
						</dav-textfield>
					</div>

					<p class="text-color text-center fw-light mt-5 fs-5"
						*ngIf="allBooks.length == 0">
						{{ locale.noBooks }}
					</p>

					<button
						class="card cursor mt-3 p-0 w-100"
						[ngClass]="allBooksHoveredIndex == i ? 'shadow' : 'shadow-sm'"
						style="transition: 0.12s"
						(click)="ShowBook(book)"
						(contextmenu)="BookContextMenu($event, book)"
						(mouseover)="allBooksHoveredIndex = i"
						(mouseout)="allBooksHoveredIndex = -1"
						(focusin)="allBooksHoveredIndex = i"
						(focusout)="allBooksHoveredIndex = -1"
						*ngFor="let book of allBooks; let i = index">

						<div class="d-flex">
							<div style="height: 100px">
								<img
									class="img-fluid rounded-start"
									style="height: 100%"
									[src]="book.cover ?? dataService.defaultStoreBookCover">
							</div>

							<div class="card-body d-flex align-items-center">
								<h5 class="card-title mb-0">{{ book.title }}</h5>
							</div>
						</div>
					</button>
				</div>
			</div>
		</div>
	</div>

	<dav-progress-ring
		class="mx-auto"
		style="width: 32px; height: 32px; margin-top: 36px"
		*ngIf="loading">
	</dav-progress-ring>
</div>

<!-- Dual-Screen layout -->
<div
	class="d-flex flex-row ms-motion-slideUpIn"
	*ngIf="dualScreenLayout">

	<!-- Left screen -->
	<div
		class="w-50"
		[style.marginRight.px]="dualScreenFoldMargin">

		<h1 class="text-center fw-light mt-3 text-color">{{ locale.title }}</h1>

		<div class="mx-auto px-5">
			<pocketlib-library-page-cards
				(addBookFilePick)="AddBookFilePick($event)">
			</pocketlib-library-page-cards>
		</div>
	</div>

	<!-- Right screen -->
	<div
		class="w-50"
		[style.marginLeft.px]="dualScreenFoldMargin">

		<div
			class="d-flex flex-wrap justify-content-center pt-3"
			style="overflow: scroll"
			[style.height.px]="dataService.contentHeight">

			<pocketlib-library-page-book-card
				*ngFor="let book of dataService.books"
				[book]="book"
				(click)="ShowBook(book)"
				(contextMenu)="BookContextMenu($event, book)">
			</pocketlib-library-page-book-card>
		</div>
	</div>
</div>

<pocketlib-loading-screen
	*ngIf="loadingScreenVisible">
</pocketlib-loading-screen>

<dav-context-menu
	[visible]="contextMenuVisible"
	[posX]="contextMenuPositionY"
	[posY]="contextMenuPositionX">

	<!-- Export -->
	<dav-context-menu-item
		[value]="locale.bookContextMenuExport"
		icon="Export"
		(click)="DownloadBook()"
		*ngIf="showExportBookOption">
	</dav-context-menu-item>

	<dav-context-menu-divider
		*ngIf="showExportBookOption">
	</dav-context-menu-divider>

	<!-- Rename -->
	<dav-context-menu-item
		[value]="locale.bookContextMenuRename"
		icon="Edit"
		(click)="ShowRenameBookDialog()"
		*ngIf="showRenameBookOption">
	</dav-context-menu-item>

	<!-- Remove -->
	<dav-context-menu-item
		[value]="locale.bookContextMenuRemove"
		icon="Delete"
		(click)="ShowRemoveBookDialog()">
	</dav-context-menu-item>
</dav-context-menu>

<dav-dialog
	[header]="locale.renameBookDialog.header"
	[primaryButtonText]="locale.save"
	[defaultButtonText]="locale.cancel"
	[visible]="renameBookDialogVisible"
	(dismiss)="renameBookDialogVisible = false"
	(primaryButtonClick)="RenameBook()"
	(defaultButtonClick)="renameBookDialogVisible = false">

	<form>
		<!-- Title -->
		<div class="mb-3">
			<dav-textfield
				[value]="renameBookDialogTitle"
				[label]="locale.renameBookDialog.titleTextfieldLabel"
				[placeholder]="locale.renameBookDialog.titleTextfieldPlaceholder"
				[errorMessage]="renameBookDialogError"
				(change)="renameBookDialogTitle = $event.detail.value; renameBookDialogError = ''"
				(enter)="RenameBook()">
			</dav-textfield>
		</div>
	</form>
</dav-dialog>

<dav-dialog
	[header]="locale.removeBookDialog.header"
	[primaryButtonText]="locale.remove"
	[defaultButtonText]="locale.cancel"
	[visible]="removeBookDialogVisible"
	primaryButtonType="danger"
	maxWidth="340"
	(dismiss)="removeBookDialogVisible = false"
	(primaryButtonClick)="RemoveBook()"
	(defaultButtonClick)="removeBookDialogVisible = false">

	<p class="text-color">{{ locale.removeBookDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[header]="locale.loginToAccessBookDialog.header"
	[primaryButtonText]="locale.loginToAccessBookDialog.login"
	[defaultButtonText]="locale.close"
	[visible]="loginToAccessBookDialogVisible"
	maxWidth="340"
	(dismiss)="loginToAccessBookDialogVisible = false"
	(primaryButtonClick)="GoToLoginPage()"
	(defaultButtonClick)="loginToAccessBookDialogVisible = false">

	<p class="text-color">{{ locale.loginToAccessBookDialog.description }}</p>
</dav-dialog>

<dav-dialog
	[header]="locale.addBookErrorDialog.header"
	[defaultButtonText]="locale.close"
	[visible]="addBookErrorDialogVisible"
	maxWidth="340"
	(dismiss)="addBookErrorDialogVisible = false"
	(defaultButtonClick)="addBookErrorDialogVisible = false">

	<p class="text-color">{{ locale.addBookErrorDialog.description }}</p>
</dav-dialog>