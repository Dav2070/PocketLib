<!-- Normal layout -->
<div class="container slide-up-in">
	<div class="mt-3 mb-4">
		<dav-header
			backButtonVisible
			editButtonVisible
			(backButtonClick)="BackButtonClick()"
			(editButtonClick)="ShowEditTitleDialog()"
		>
			{{ book.title }}
		</dav-header>
	</div>

	<div
		class="mt-3 mb-4 mx-auto"
		style="min-width: 200px; max-width: 300px"
		*ngIf="errorMessage.length > 0"
	>
		<dav-message-bar type="danger">
			{{ errorMessage }}
		</dav-message-bar>
	</div>

	<div class="d-flex justify-content-center mb-4">
		<div id="book-details-container">
			<!-- Release notes -->
			<div
				id="book-details-release-notes-label"
				*ngIf="release != null && release.releaseNotes"
			>
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.releaseNotes }}:
				</p>
			</div>

			<div
				id="book-details-release-notes-data"
				class="book-details-data"
				*ngIf="release != null && release.releaseNotes"
			>
				<p
					class="text-color"
					style="margin-top: 3px; max-width: 400px; white-space: pre-line"
				>
					{{ release.releaseNotes }}
				</p>
			</div>

			<!-- Cover -->
			<div id="book-details-cover-label">
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.cover }}:
				</p>
			</div>

			<div id="book-details-cover-data" class="book-details-data">
				<p
					class="fw-light fst-italic text-color"
					style="margin-top: 3px"
					*ngIf="!coverContent"
				>
					{{ locale.noCover }}
				</p>
				<div class="mb-3" *ngIf="coverContent">
					<dav-blurhash-image
						style="border-radius: 8px"
						[src]="coverContent"
						[fallbackSrc]="dataService.defaultStoreBookCover"
						[blurhash]="book.coverBlurhash"
						height="200"
						width="140"
						[loading]="coverLoading"
					></dav-blurhash-image>
				</div>

				<dav-button
					type="accent"
					ngxFilePicker
					accept="image/png,image/jpeg"
					[disabled]="coverLoading"
					(filePick)="CoverUpload($event)"
					*ngIf="release == null"
				>
					{{ locale.uploadCover }}
				</dav-button>
			</div>

			<!-- Description -->
			<div id="book-details-description-label">
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.description }}:
				</p>
			</div>

			<div id="book-details-description-data" class="book-details-data">
				<p
					class="text-color"
					style="margin-top: 3px; max-width: 400px; white-space: pre-line"
					*ngIf="book.description && !editDescription"
				>
					{{ book.description }}
				</p>
				<p
					class="fw-light fst-italic text-color"
					style="margin-top: 3px"
					*ngIf="!book.description && !editDescription"
				>
					{{ locale.noDescription }}
				</p>

				<div
					style="margin-top: 3px; margin-bottom: 16px; min-width: 300px"
					*ngIf="editDescription"
				>
					<dav-textarea
						[value]="newDescription"
						[placeholder]="locale.descriptionTextfieldPlaceholder"
						resize="vertical"
						[errorMessage]="newDescriptionError"
						(change)="
							newDescription = $event.detail.value;
							newDescriptionError = ''
						"
					></dav-textarea>
				</div>

				<dav-button
					type="accent"
					[disabled]="descriptionLoading"
					(click)="EditDescription()"
					*ngIf="release == null"
				>
					{{ editDescription ? locale.save : locale.edit }}
				</dav-button>

				<dav-button
					style="margin-left: 10px"
					[disabled]="descriptionLoading"
					(click)="editDescription = false"
					*ngIf="editDescription"
				>
					{{ locale.cancel }}
				</dav-button>
			</div>

			<!-- Language -->
			<div id="book-details-language-label">
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.language }}:
				</p>
			</div>

			<div id="book-details-language-data" class="d-flex book-details-data">
				<pocketlib-language-dropdown
					[language]="book.language"
					[disabled]="
						(book.status == 2 || book.status == 3) && release != null
					"
					(updated)="SetLanguage($event)"
				></pocketlib-language-dropdown>
			</div>

			<!-- Categories -->
			<div id="book-details-categories-label">
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.categories }}:
				</p>
			</div>

			<div id="book-details-categories-data" class="book-details-data">
				<div class="d-flex">
					<div class="my-auto">
						<span
							class="badge rounded-pill me-2"
							[ngClass]="i == 0 ? 'bg-primary' : 'bg-secondary'"
							*ngFor="let category of book.categories; let i = index"
						>
							{{ category.name }}
						</span>
					</div>

					<button
						type="button"
						class="btn ms-2 text-color theme-background-color-primary theme-border-color-primary icon-button"
						style="height: 35px; padding: 3px 6px; font-size: 16px"
						(click)="ShowCategoriesDialog()"
						*ngIf="release == null"
					>
						<fa-icon [icon]="faPenLight"></fa-icon>
					</button>
				</div>
			</div>

			<!-- Price -->
			<div id="book-details-price-label">
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.price }}:
				</p>
			</div>

			<div id="book-details-price-data" class="book-details-data">
				<pocketlib-price-input
					#priceInput
					[canEdit]="release == null"
					(update)="UpdatePrice($event)"
				></pocketlib-price-input>
			</div>

			<!-- ISBN -->
			<div id="book-details-isbn-label">
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					ISBN:
				</p>
			</div>

			<div
				id="book-details-isbn-data"
				class="d-flex text-color book-details-data"
			>
				<pocketlib-isbn-input
					#isbnInput
					[canEdit]="release == null"
					(update)="UpdateIsbn($event)"
				></pocketlib-isbn-input>
			</div>

			<!-- Book file -->
			<div id="book-details-book-file-label">
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.bookFile }}:
				</p>
			</div>

			<div id="book-details-book-file-data" class="book-details-data">
				<p
					class="fw-light fst-italic text-color"
					style="margin-top: 3px"
					*ngIf="!bookFileUploaded && !bookFileLoading"
				>
					{{ locale.noBookFile }}
				</p>
				<p
					class="fw-light text-color"
					*ngIf="
						bookFileUploaded && book.fileName == null && !bookFileLoading
					"
				>
					{{ locale.bookFileUploaded }}
				</p>
				<p
					class="fw-light text-color"
					*ngIf="
						bookFileUploaded && book.fileName != null && !bookFileLoading
					"
				>
					{{ book.fileName }}
				</p>
				<p class="fw-light text-color" *ngIf="bookFileLoading">
					{{ locale.bookFileUploading }}
				</p>

				<div class="d-flex">
					<dav-button
						type="accent"
						ngxFilePicker
						accept="application/epub+zip"
						[disabled]="bookFileLoading"
						(filePick)="BookFileUpload($event)"
						*ngIf="release == null"
					>
						{{ locale.uploadBookFile }}
					</dav-button>

					<dav-progress-ring
						style="margin: 8px 0px 0px 14px"
						size="16"
						*ngIf="bookFileLoading"
					></dav-progress-ring>
				</div>
			</div>

			<!-- Status -->
			<div
				id="book-details-status-label"
				*ngIf="book.status == 0 && release == null"
			>
				<p class="me-3 fw-light text-color" style="font-size: 19px">
					{{ locale.status }}:
				</p>
			</div>

			<div id="book-details-status-data" class="book-details-data">
				<div *ngIf="book.status == 0">
					<p class="text-color">{{ locale.unpublished }}</p>

					<div class="d-flex">
						<dav-button
							type="accent"
							[disabled]="
								!coverContent ||
								!bookFileUploaded ||
								!book.description ||
								statusLoading
							"
							(click)="PublishBook()"
						>
							{{ locale.publish }}
						</dav-button>

						<dav-progress-ring
							style="margin: 8px 0px 0px 14px"
							size="16"
							*ngIf="statusLoading"
						></dav-progress-ring>
					</div>
				</div>

				<div
					class="d-flex"
					*ngIf="
						(book.status == 2 || book.status == 3) &&
						release == null &&
						changes
					"
				>
					<dav-button
						type="accent"
						[disabled]="publishChangesLoading"
						(click)="ShowPublishChangesDialog()"
					>
						{{ locale.publishChanges }}
					</dav-button>
				</div>
			</div>
		</div>
	</div>
</div>

<dav-dialog
	[headline]="locale.editTitleDialog.headline"
	[primaryButtonText]="locale.save"
	[defaultButtonText]="locale.cancel"
	[visible]="editTitleDialogVisible"
	[loading]="editTitleDialogLoading"
	(dismiss)="editTitleDialogVisible = false"
	(primaryButtonClick)="UpdateTitle()"
	(defaultButtonClick)="editTitleDialogVisible = false"
>
	<form>
		<!-- Title -->
		<div class="mb-3">
			<dav-textfield
				[value]="editTitleDialogTitle"
				[label]="locale.editTitleDialog.titleTextfieldLabel"
				[placeholder]="locale.editTitleDialog.titleTextfieldPlaceholder"
				[errorMessage]="editTitleDialogTitleError"
				[disabled]="editTitleDialogLoading"
				(change)="
					editTitleDialogTitle = $event.detail.value;
					editTitleDialogTitleError = ''
				"
				(enter)="UpdateTitle()"
			></dav-textfield>
		</div>
	</form>
</dav-dialog>

<dav-dialog
	[headline]="locale.categoriesSelectionDialog.headline"
	[primaryButtonText]="locale.save"
	[defaultButtonText]="locale.cancel"
	[visible]="categoriesSelectionDialogVisible"
	[loading]="categoriesSelectionDialogLoading"
	(dismiss)="categoriesSelectionDialogVisible = false"
	(primaryButtonClick)="UpdateCategories()"
	(defaultButtonClick)="categoriesSelectionDialogVisible = false"
>
	<div class="mb-3">
		<pocketlib-categories-selection #categoriesSelection>
		</pocketlib-categories-selection>
	</div>
</dav-dialog>

<dav-dialog
	[headline]="locale.publishChangesDialog.headline"
	[primaryButtonText]="locale.publish"
	[defaultButtonText]="locale.cancel"
	[visible]="publishChangesDialogVisible"
	[loading]="publishChangesDialogLoading"
	(primaryButtonClick)="PublishChanges()"
	(defaultButtonClick)="publishChangesDialogVisible = false"
>
	<form>
		<!-- Release name -->
		<div class="mb-3">
			<dav-textfield
				[value]="publishChangesDialogReleaseName"
				[label]="locale.publishChangesDialog.releaseNameTextfieldLabel"
				[placeholder]="
					locale.publishChangesDialog.releaseNameTextfieldPlaceholder
				"
				[errorMessage]="publishChangesDialogReleaseNameError"
				[disabled]="publishChangesDialogLoading"
				(change)="
					publishChangesDialogReleaseName = $event.detail.value;
					ClearPublishChangesErrors()
				"
				(enter)="PublishChanges()"
			></dav-textfield>
		</div>

		<!-- Release notes -->
		<div class="mb-3">
			<dav-textarea
				[value]="publishChangesDialogReleaseNotes"
				[label]="locale.publishChangesDialog.releaseNotesTextfieldLabel"
				[placeholder]="
					locale.publishChangesDialog.releaseNotesTextfieldPlaceholder
				"
				[disabled]="publishChangesDialogLoading"
				(change)="
					publishChangesDialogReleaseNotes = $event.detail.value;
					ClearPublishChangesErrors()
				"
			></dav-textarea>
		</div>
	</form>
</dav-dialog>
